<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:local="flex.admin.components.*"
                layout="absolute" backgroundGradientColors="[0x000000,0x323232]"
                initialize="initializeHandler()">
    <mx:VBox x="15" y="15">
        <local:MonthChooser
                id="mChosenMonth"
                yearNavigationEnabled="true"
                styleName="monthChooserStyles"
                selectedDate="{chosenMonth}"
                change="updateDates()"
                />
        <mx:Button color="0x323232" height="32" label="Napisz podanie o urlop" click="showWindow();"/>
    </mx:VBox>

    <local:EntryGrid id="entryGrid">

    </local:EntryGrid>

    <mx:Script><![CDATA[
        import flex.admin.components.HolidayAcceptForm;
        import flex.admin.model.UserEntry;
        import flex.admin.model.UserEntry;
        import flex.admin.services.impl.AdminDataServiceMock;
        import flex.service.HolidayFlexService;

        import mx.collections.ArrayCollection;

        import mx.controls.Alert;
        import mx.managers.PopUpManager;
        import mx.rpc.events.ResultEvent;

        public var username:String = "szef";
        public var password:String = "szef";

        [Bindable]
        private var chosenMonth:Date;

        private var holidayFlexService:HolidayFlexService;

        private var holidayForm:HolidayAcceptForm;

        private function initializeHandler():void {
            holidayFlexService = new HolidayFlexService();
        }

        private function showWindow():void {
            holidayForm = HolidayAcceptForm(PopUpManager.createPopUp(this, HolidayAcceptForm, true));
//            PopUpManager.centerPopUp(holidayForm as Dialog);
            holidayFlexService.findDataForChosenUser('kowalski', updateModalDialog);
//            holidayForm.addEventListener(HolidaySendRequestEvent.SEND_HOLIDAY_REQUEST, holidayFormSendRequestHandler);
        }

        private function updateModalDialog(event:ResultEvent):void {
            var currentUserData:ArrayCollection = new ArrayCollection();
            currentUserData.source = (event.result as ArrayCollection).source;
            holidayForm.setUserHolidayProvider(currentUserData);
        }
        
        private function updateDates():void {
            chosenMonth = mChosenMonth.selectedDate;
        }

        private function onEntry():void {
            Alert.show("Show");
            var adminDataServiceMock:AdminDataServiceMock = new AdminDataServiceMock();

            Alert.show("Show2");
            var collection:ArrayCollection = adminDataServiceMock.getEntries(2012, 6);

            var length = collection.length;
            Alert.show(length+"");
            var userEntry:UserEntry = UserEntry(collection[0]);
            Alert.show(userEntry.login);
            entryGrid.addEntry(collection[0]);
            entryGrid.addEntry(collection[1]);
        }
        ]]></mx:Script>
</mx:Application>