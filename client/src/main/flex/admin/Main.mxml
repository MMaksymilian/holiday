<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:form="flex.admin.components.forms.*" xmlns:local="flex.admin.components.*"
                layout="absolute" backgroundGradientColors="[0x000000,0x323232]"
                initialize="initializeHandler()" applicationComplete="onEntry()">
    <mx:Panel width="100%" height="400" paddingLeft="40" paddingRight="40" paddingTop="10" paddingBottom="10">
        <mx:LinkBar color="0x0050AA" horizontalAlign="center" width="100%" fontWeight="bold"
                    dataProvider="{adminViewStack}"
                    borderColor="0xACACAC" borderStyle="solid"/>
        <mx:ViewStack id="adminViewStack" borderStyle="solid" width="100%"  height="100%" color="0x323232">

            <!--Zakładka z danymi o urlopach-->
            <mx:VBox label="Urlopy" backgroundColor="0xDCDCDC" width="100%" paddingLeft="40" paddingRight="40" paddingTop="10" paddingBottom="10" fontWeight="bold">
                <local:MonthChooser
                        id="mChosenMonth"
                        yearNavigationEnabled="true"
                        styleName="monthChooserStyles"
                        selectedDate="{chosenMonth}"
                        change="updateDates()"/>
                <mx:Button color="0x323232" height="32" label="Napisz podanie o urlop" cornerRadius="12" click="showWindow();"/>

                <local:EntryGrid id="entryGrid" creationComplete="entryGrid.setDecisionHandler(updateDates);">

                </local:EntryGrid>
            </mx:VBox>

            <!--Zakładka z danymi użytkowników-->
            <mx:VBox label="Pracownicy" backgroundColor="0xDCDCDC"  width="100%" paddingLeft="40" paddingRight="40" paddingTop="10" paddingBottom="10" fontWeight="bold">
                <form:NewUserForm/>
            </mx:VBox>
        </mx:ViewStack>
    </mx:Panel>
    <mx:Script><![CDATA[
        import flex.admin.components.forms.HolidayAcceptForm;
        import flex.admin.event.CreateNewUserEvent;
        import flex.admin.model.HolidayExtDTO;
        import flex.admin.model.UserEntry;
        import flex.admin.services.AdminDataService;
        import flex.admin.services.impl.AdminDataServiceImpl;
        import flex.admin.services.AdminDataService;
        import flex.admin.services.impl.AdminDataServiceImpl;
        import flex.admin.services.impl.AdminDataServiceMock;

        import mx.collections.ArrayCollection;
        import mx.controls.Alert;
        import mx.managers.PopUpManager;
        import mx.rpc.events.ResultEvent;

        public var username:String = "szef";
        public var password:String = "szef";

        [Bindable]
        private var chosenMonth:Date;
        private var adminDataService:AdminDataService = new AdminDataServiceImpl();

        private var holidayForm:HolidayAcceptForm;

        private function initializeHandler():void {
            updateDates();
        }

        private function showWindow():void {
            holidayForm = HolidayAcceptForm(PopUpManager.createPopUp(this, HolidayAcceptForm, true));
            adminDataService.findDataForChosenUser('kowalski', updateModalDialog);
        }

        private function updateModalDialog(event:ResultEvent):void {
            var currentUserData:ArrayCollection = new ArrayCollection();
            currentUserData.source = (event.result as ArrayCollection).source;
            holidayForm.setUserHolidayProvider(currentUserData);
        }

        private function updateDates():void {
            chosenMonth = mChosenMonth.selectedDate;
            entryGrid.year = chosenMonth.fullYear;
            entryGrid.month = chosenMonth.month+1;
            adminDataService.getEntries(chosenMonth.fullYear, chosenMonth.month+1, handleUpdate);
        }

        private function handleUpdate(event: ResultEvent):void {
            var entryCollection:ArrayCollection = event.result as ArrayCollection;
            entryGrid.update(entryCollection);
        }

        private function onEntry():void {
            addEventListener(CreateNewUserEvent.CREATE_NEW_USER, sendCreateNewUserRequest);
        }


        private function sendCreateNewUserRequest(event:CreateNewUserEvent):void {
            adminDataService.createNewUser(event.newUser, successfullyCreatedNewUserHandler);
        }

        private function successfullyCreatedNewUserHandler(event:ResultEvent):void {
            Alert.show('Utworzono nowego użytkownika');
        }
        ]]></mx:Script>
</mx:Application>