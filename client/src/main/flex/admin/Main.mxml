<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:local="flex.admin.components.*"
                layout="absolute" backgroundGradientColors="[0x000000,0x323232]"
                initialize="initializeHandler()" applicationComplete="onEntry()">
    <mx:Panel width="100%" height="400" paddingLeft="40" paddingRight="40" paddingTop="10" paddingBottom="10">
        <mx:LinkBar color="0x0050AA" horizontalAlign="center" width="100%" fontWeight="bold"
                    dataProvider="{adminViewStack}"
                    borderColor="0xACACAC" borderStyle="solid"/>
        <mx:ViewStack id="adminViewStack" borderStyle="solid" width="100%"  height="100%" color="0x323232">

            <!--Zakładka z danymi o urlopach-->
            <mx:VBox label="Urlopy" backgroundColor="0xDCDCDC" width="100%" paddingLeft="40" paddingRight="40" paddingTop="10" paddingBottom="10" fontWeight="bold">
                <local:MonthChooser
                        id="mChosenMonth"
                        yearNavigationEnabled="true"
                        styleName="monthChooserStyles"
                        selectedDate="{chosenMonth}"
                        change="updateDates()"
                        />
                <mx:Button color="0x323232" height="32" label="Napisz podanie o urlop" cornerRadius="12" click="showWindow();"/>

                <local:EntryGrid id="entryGrid">

                </local:EntryGrid>
            </mx:VBox>

            <!--Zakładka z danymi użytkowników-->
            <mx:VBox label="Pracownicy" backgroundColor="0xDCDCDC"  width="100%" paddingLeft="40" paddingRight="40" paddingTop="10" paddingBottom="10" fontWeight="bold">
                <mx:Form id="addUserForm" width="100%" color="0x323232">
                    <mx:FormHeading fontSize="10"  label="Dodanie nowego użytkownika" paddingTop="0" />

                    <mx:FormItem label="Imię: " required="true">
                        <mx:TextInput id="fNameAddUser" width="200"/>
                    </mx:FormItem>

                    <mx:FormItem label="Nazwisko: " required="true">
                        <mx:TextInput id="lNameAddUser" width="200"/>
                    </mx:FormItem>

                    <mx:FormItem label="Login: " required="true">
                        <mx:TextInput id="loginAddUser" width="200"/>
                    </mx:FormItem>

                    <mx:FormItem label="Hasło: " required="true">
                        <mx:TextInput id="passwordAddUser" width="200"/>
                    </mx:FormItem>

                    <mx:FormItem >
                        <mx:Button id="submitButton" label="Zatwierdź" cornerRadius="12"/>
                    </mx:FormItem>
                </mx:Form>
            </mx:VBox>
        </mx:ViewStack>
    </mx:Panel>
    <mx:Script><![CDATA[
        import flex.admin.components.HolidayAcceptForm;
        import flex.admin.components.forms.DecisionForm;
        import flex.admin.model.UserEntry;
        import flex.admin.model.UserEntry;
        import flex.admin.services.impl.AdminDataServiceMock;
        import flex.event.admin.AcceptHolidayEvent;
        import flex.event.admin.RejectHolidayEvent;
        import flex.service.HolidayFlexService;

        import mx.collections.ArrayCollection;

        import mx.controls.Alert;
        import mx.managers.PopUpManager;
        import mx.rpc.events.ResultEvent;

        public var username:String = "szef";
        public var password:String = "szef";

        [Bindable]
        private var chosenMonth:Date;

        private var holidayFlexService:HolidayFlexService;

        private var holidayForm:HolidayAcceptForm;

        private function initializeHandler():void {
            // holidayFlexService = new HolidayFlexService();
        }

        private function showWindow():void {
            holidayForm = HolidayAcceptForm(PopUpManager.createPopUp(this, HolidayAcceptForm, true));
//            PopUpManager.centerPopUp(holidayForm as Dialog);
            holidayFlexService.findDataForChosenUser('kowalski', updateModalDialog);
//            holidayForm.addEventListener(AcceptHolidayEvent.acceptHolidayEvent, sendAcceptHolidayRequest);
//            holidayForm.addEventListener(RejectHolidayEvent.rejectHolidayEvent, sendRejectHolidayRequest);
        }

        //        private function sendAcceptHolidayRequest(event:AcceptHolidayEvent) {
        //            Alert.show('Akceptuj');
        //        }
        //
        //        private function sendRejectHolidayRequest(event:RejectHolidayEvent) {
        //            Alert.show('Odrzuć');
        //        }

        private function updateModalDialog(event:ResultEvent):void {
            var currentUserData:ArrayCollection = new ArrayCollection();
            currentUserData.source = (event.result as ArrayCollection).source;
            holidayForm.setUserHolidayProvider(currentUserData);
        }

        private function updateDates():void {
            chosenMonth = mChosenMonth.selectedDate;
        }

        private function onEntry():void {
            var adminDataServiceMock:AdminDataServiceMock = new AdminDataServiceMock();
            var collection:ArrayCollection = adminDataServiceMock.getEntries(2012, 6);

            var userEntry:UserEntry = UserEntry(collection.getItemAt(0));
            entryGrid.addEntry(userEntry);
        }
        ]]></mx:Script>

    <mx:StringValidator minLength="6" maxLength="100"  source="{passwordAddUser}" property="text" trigger="{submitButton}" triggerEvent="click"/>
    <mx:Validator required="true" source="{fNameAddUser}" property="text" trigger="{submitButton}" triggerEvent="click"/>
    <mx:Validator required="true" source="{lNameAddUser}" property="text" trigger="{submitButton}" triggerEvent="click"/>
    <mx:Validator required="true" source="{loginAddUser}" property="text" trigger="{submitButton}" triggerEvent="click"/>
</mx:Application>