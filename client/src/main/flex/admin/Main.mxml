<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:local="flex.admin.components.*"
                layout="absolute" backgroundGradientColors="[0x000000,0x323232]"
                initialize="initializeHandler()" applicationComplete="onEntry()">
    <mx:VBox x="15" y="15">
        <local:MonthChooser
                id="mChosenMonth"
                yearNavigationEnabled="true"
                styleName="monthChooserStyles"
                selectedDate="{chosenMonth}"
                change="updateDates()"
                />
        <mx:Button color="0x323232" height="32" label="Napisz podanie o urlop" click="showWindow();"/>


        <local:EntryGrid id="entryGrid">

        </local:EntryGrid>
    </mx:VBox>


    <mx:Script><![CDATA[
        import flex.admin.components.HolidayAcceptForm;
        import flex.admin.components.forms.DecisionForm;
        import flex.admin.model.HolidayExtDTO;
        import flex.admin.model.UserEntry;
        import flex.admin.model.UserEntry;
        import flex.admin.services.AdminDataService;
        import flex.admin.services.impl.AdminDataServiceImpl;
        import flex.admin.services.impl.AdminDataServiceMock;
        import flex.event.admin.AcceptHolidayEvent;
        import flex.event.admin.RejectHolidayEvent;
        import flex.service.HolidayFlexService;

        import mx.collections.ArrayCollection;

        import mx.managers.PopUpManager;
        import mx.rpc.events.ResultEvent;

        public var username:String = "szef";
        public var password:String = "szef";

        [Bindable]
        private var chosenMonth:Date;
        private var adminDataService:AdminDataService = new AdminDataServiceImpl();
        private var holidayFlexService:HolidayFlexService;
        private var holidayForm:HolidayAcceptForm;

        private function initializeHandler():void {

        }

        private function showWindow():void {
            holidayForm = HolidayAcceptForm(PopUpManager.createPopUp(this, HolidayAcceptForm, true));
            holidayFlexService.findDataForChosenUser('kowalski', updateModalDialog);
        }

        private function updateModalDialog(event:ResultEvent):void {
            var currentUserData:ArrayCollection = new ArrayCollection();
            currentUserData.source = (event.result as ArrayCollection).source;
            holidayForm.setUserHolidayProvider(currentUserData);
        }

        private function updateDates():void {
            chosenMonth = mChosenMonth.selectedDate;
        }

        private function updateGrid():void {
            entryGrid.year = 2012;
            entryGrid.month = 8;
            adminDataService.getEntries(2012, 8, handleUpdate);
        }

        private function handleUpdate(event: ResultEvent):void {
            var entryCollection:ArrayCollection = event.result as ArrayCollection;
            entryGrid.update(entryCollection);
        }

        private function onEntry():void {
            updateGrid();
        }

        ]]></mx:Script>
</mx:Application>